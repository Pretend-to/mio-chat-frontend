# 前后端集成测试清单

## 基于后端验证报告的前端适配

### ✅ 已完成的前端适配

1. **数据结构适配**
   - ✅ 支持新的扁平化预设数组结构
   - ✅ 正确处理 `source` 和 `category` 字段
   - ✅ 适配新的 API 响应格式 `{data: {presets: [...]}}`

2. **PresetEditor 增强**
   - ✅ 添加了 `category` 字段选择器
   - ✅ 表单验证包含 `category` 必填验证
   - ✅ 创建/编辑时正确提交 `category` 字段

3. **PresetCard 显示优化**
   - ✅ 显示预设来源标签 (`built-in`/`custom`)
   - ✅ 根据 `source` 字段控制删除按钮可用性
   - ✅ 条件渲染避免空标签显示

4. **导出功能增强**
   - ✅ 改进了文件名解析的正则表达式
   - ✅ 添加了备用导出方案（当后端导出失败时）
   - ✅ 更好的 DOM 操作兼容性

### 🧪 需要测试的功能

#### 基础 CRUD 操作
- [ ] 获取预设列表（分页、搜索、筛选）
- [ ] 获取预设详情
- [ ] 创建新预设（包含 category 字段）
- [ ] 编辑现有预设
- [ ] 删除自定义预设
- [ ] 验证内置预设保护机制

#### 高级功能
- [ ] 预设导出功能（包含备用方案）
- [ ] 预设导入功能
- [ ] 批量删除功能
- [ ] 预设缓存重载

#### UI/UX 测试
- [ ] 分类折叠/展开功能
- [ ] 多选功能
- [ ] 搜索和筛选
- [ ] 响应式布局

### 🔧 测试步骤

#### 1. 创建预设测试
```javascript
// 测试数据
const testPreset = {
  name: "测试预设",
  category: "common",
  history: [
    {
      role: "system",
      content: "你是一个测试助手"
    }
  ],
  opening: "这是测试开场白",
  tools: ["web_search"]
};
```

#### 2. 验证数据结构
检查前端接收到的数据是否包含：
- `name`: 预设名称
- `source`: "built-in" 或 "custom"
- `category`: "common", "recommended", 或 "hidden"
- `history`: 对话历史数组
- `opening`: 开场白（可选）
- `tools`: 工具数组（可选）

#### 3. 权限测试
- 验证内置预设无法编辑/删除
- 验证自定义预设可以正常 CRUD
- 验证管理员权限验证

### 📋 问题排查清单

如果遇到问题，按以下顺序检查：

1. **网络请求**
   - 检查 API 端点是否正确
   - 验证 `X-Admin-Code` 头部是否正确设置
   - 查看浏览器网络面板的请求/响应

2. **数据格式**
   - 确认后端返回的数据结构符合文档规范
   - 检查前端是否正确解析 `data.presets` 数组
   - 验证预设对象包含所有必需字段

3. **UI 状态**
   - 检查 loading 状态是否正确显示
   - 验证错误信息是否正确展示
   - 确认分类显示是否正常

### 🚀 部署前检查

- [ ] 所有 TypeScript/JavaScript 语法错误已修复
- [ ] 所有 Vue 组件可以正常渲染
- [ ] API 调用使用正确的端点和参数
- [ ] 错误处理覆盖所有可能的失败场景
- [ ] 用户体验流畅，无明显卡顿

### 📝 已知问题和解决方案

1. **导出功能 Content-Disposition 问题**
   - 状态：后端已知问题
   - 前端解决方案：添加了备用导出机制
   - 影响：用户仍可正常导出预设

2. **批量删除功能**
   - 状态：后端已实现但未测试
   - 前端状态：已实现并可用
   - 建议：优先测试此功能

---

**测试负责人**: 前端开发团队  
**测试时间**: 2024-12-11  
**下次检查**: 2024-12-12